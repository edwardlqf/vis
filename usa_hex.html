<!DOCTYPE html>
<meta charset="utf-8">

<!-- Load d3.js -->
<script src="https://d3js.org/d3.v4.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
<script type="text/javascript" src="../lib/d3-legend.min.js"></script>
<script type="text/javascript" src="../lib/d3-tip.min.js"></script>

<!-- Create an element where the map will take place -->
<svg id="my_dataviz" width="1200" height="900"></svg>

<script>

	// The svg
	var svg = d3.select("svg"),
		width = +svg.attr("width"),
		height = +svg.attr("height");
	
	// Map and projection
	var projection = d3.geoMercator()
		.scale(500) // This is the zoom
		.translate([width+200, height-200]); // You have to play with these values to center your map
	
	// Path generator
	var path = d3.geoPath()
		.projection(projection)


	var tip = d3.tip().attr('class', 'd3-tip').offset([0,10]) // create a tip where each property is on its own line
				.html(function(d) { 
					return "<strong style='color:lightblue'>State: </strong><span style='color:black'>"+ d.properties.google_name + "</span><br>"
	})  

	
	var randomColor = (function(){
		var golden_ratio_conjugate = 0.618033988749895;
		var h = Math.random();
		var hslToRgb = function (h, s, l){
			var r, g, b;
			if(s == 0){
				r = g = b = l; // achromatic
			}else{
				function hue2rgb(p, q, t){
					if(t < 0) t += 1;
					if(t > 1) t -= 1;
					if(t < 1/6) return p + (q - p) * 6 * t;
					if(t < 1/2) return q;
					if(t < 2/3) return p + (q - p) * (2/3 - t) * 6;
					return p;
				}
				var q = l < 0.5 ? l * (1 + s) : l + s - l * s;
				var p = 2 * l - q;
				r = hue2rgb(p, q, h + 1/3);
				g = hue2rgb(p, q, h);
				b = hue2rgb(p, q, h - 1/3);
			}
			return '#'+Math.round(r * 255).toString(16)+Math.round(g * 255).toString(16)+Math.round(b * 255).toString(16);
		};
		return function(){
			h += golden_ratio_conjugate;
			h %= 1;
			return hslToRgb(h, 0.5, 0.60);
		};
		})();
				

	// Load external data and boot
	d3.json("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/us_states_hexgrid.geojson.json", function(data){
	
	  // Draw the map
	  svg.append("g")
		  .selectAll("path")
		  .data(data.features)
		  .enter()
		  .append("path")
			  .attr("fill", randomColor)
			  .attr("d", path)
			  .attr("stroke", "white")
			  .attr("class", "name")
			  .on('mouseover', tip.show) 
			  .on('mouseout', tip.hide)
			  .call(tip);
	
	  // Add the labels  
	//   svg.append("g")
	// 	  .selectAll("labels")
	// 	  .data(data.features)
	// 	  .enter()
	// 	  .append("text")
	// 		.attr("x", function(d){return path.centroid(d)[0]})
	// 		.attr("y", function(d){return path.centroid(d)[1]})
	// 		.text(function(d){ return d.properties.iso3166_2})
	// 		.attr("text-anchor", "middle")
	// 		.attr("alignment-baseline", "central")
	// 		.style("font-size", 11)
	// 		.style("fill", randomColor)

	})
	
	</script>